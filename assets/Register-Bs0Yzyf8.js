import{r as o,j as e}from"./@react-vendor-DfZ2FJF2.js";import{d as L,e as R,u as I,a as P,b as _,c as A,L as z,T as u,B as g}from"./index-BrH10NPX.js";import{b as U,p as D,e as $}from"./@networking-vendor-C--vnpcj.js";const p=/^[ㄱ-ㅎ가-힣a-zA-Z0-9]+$/,m=/^(?=.*[a-zA-Z])(?=.*[0-9]).{6,20}$/,f=/^(?=.*[a-zA-Z])(?=.*[0-9])(?=.*[!@#$%^&*?_]).{8,16}$/,F=async({accountId:t})=>U(`/v2/users/${t}/exists`).then(a=>a.data).then(a=>({data:{isUsed:a.isUsed},message:a.isUsed?"사용중인 아이디입니다.":"사용 가능한 아이디입니다.",status:200})),G=t=>L({enabled:m.test(t),queryFn:({queryKey:l})=>F({accountId:l[1]}),queryKey:R.existingId(t),select:l=>l.data.isUsed}),K=async t=>D("/v2/users",t).then(a=>a.data),X=({onError:t,onSuccess:a})=>I({mutationFn:K,onError:s=>{t&&t(s)},onSuccess:s=>{a&&a(s)}});function O(){const t=P(),{onSocketConnect:a}=_(),{onToast:l}=A(),[s,j]=o.useState(""),[c,b]=o.useState(""),[r,k]=o.useState(""),[i,y]=o.useState(""),[E,x]=o.useState(!1),{data:d}=G(s),{mutate:h}=X({onError(n){x(!1),l(n.message,{delay:5e3})},onSuccess({tokens:n}){$(n),a(),x(!1),t("/",{replace:!0})}}),w=o.useCallback(n=>{n.preventDefault(),x(!0),h({id:s,nickname:c,password:r})},[h,s,c,r]),C=o.useCallback(()=>{t("/login")},[t]),v=o.useMemo(()=>{let n=!0;return p.test(c)||(n=!1),(!m.test(s)||d)&&(n=!1),f.test(r)||(n=!1),r!==i&&(n=!1),n},[s,r,i,c,d]),{idErrorMessage:M,nicknameErrorMessage:S,passwordCheckErrorMessage:T,passwordErrorMessage:N}=o.useMemo(()=>({nicknameErrorMessage:c.length<3?"최소 3자, 최대 20자까지 입력할 수 있습니다.":p.test(c)?"":"영문과 숫자 조합으로 입력하세요.",idErrorMessage:d?"중복된 아이디입니다. 다른 아이디를 입력하세요.":s.length<6?"최소 6자, 최대 20자까지 입력할 수 있습니다.":m.test(s)?"":"영문과 숫자 조합으로 입력하세요.",passwordErrorMessage:r.length<8?"최소 8자, 최대 16자까지 입력할 수 있습니다.":f.test(r)?"":"영문, 숫자, 특수문자 조합으로 입력하세요.",passwordCheckErrorMessage:i?r!==i?"비밀번호와 일치하지 않습니다.":"":"비밀번호 확인을 입력하세요."}),[c,d,s,r,i]);return e.jsxs("div",{className:"mt-5 flex h-full w-full items-start justify-center md:mt-0",children:[E&&e.jsx("div",{className:"fixed inset-0 z-1000 flex cursor-progress items-center justify-center bg-black/30",children:e.jsx(z,{})}),e.jsxs("form",{className:"flex w-full max-w-screen-md flex-col gap-5 px-5",onSubmit:w,children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-center font-jua text-28-R-36 text-white md:text-36-R-40 dark:text-primary-100",children:["작은 대화",e.jsx("br",{})]}),e.jsx("h2",{className:"mb-5 text-center font-jua text-24-R-32 text-white md:mb-10 md:text-28-R-36 dark:text-primary-100",children:"회원가입"})]}),e.jsx(u,{helperText:S,labelText:"Nickname",maxLength:20,minLength:3,type:"text",value:c,onChange:b,placeholder:"닉네임을 입력하세요."}),e.jsx(u,{helperText:M,labelText:"Id",maxLength:20,minLength:6,type:"text",value:s,onChange:j,placeholder:"아이디를 입력하세요."}),e.jsx(u,{helperText:N,labelText:"Password",maxLength:16,minLength:8,type:"password",value:r,onChange:k,placeholder:"비밀번호를 입력하세요."}),e.jsx(u,{helperText:T,labelText:"Password Check",maxLength:16,minLength:8,type:"password",value:i,onChange:y,placeholder:"비밀번호 확인을 입력하세요."}),e.jsxs("div",{className:"mt-4 flex flex-col gap-2",children:[e.jsx(g,{disabled:!v,size:"large",text:"회원가입",type:"submit",variant:"contained"}),e.jsx(g,{size:"large",text:"로그인",type:"button",variant:"outlined",onClick:C})]})]})]})}export{O as default};
