import{r as s,j as e}from"./@react-vendor-BjtCfNPP.js";import{Q as q,i as O,h as G,g as V,j as J,M as W,T as Y,B as D,k as R,d as U,f as A,b as B,u as X,c as z,I as k,a as ee,l as te,m as re,n as se,L as ne,F as ae,o as ie,p as le}from"./index-g_n27zWi.js";import{F as oe,g as ce}from"./date-BmmM7BKL.js";import{b as I,f as de,g as ue,S as me}from"./@network-vendor-CcVnuzvd.js";import{E as he}from"./@emoji-vendor-Df1QA2W1.js";var xe=class extends q{constructor(t,r){super(t,r)}bindMethods(){super.bindMethods(),this.fetchNextPage=this.fetchNextPage.bind(this),this.fetchPreviousPage=this.fetchPreviousPage.bind(this)}setOptions(t,r){super.setOptions({...t,behavior:O()},r)}getOptimisticResult(t){return t.behavior=O(),super.getOptimisticResult(t)}fetchNextPage(t){return this.fetch({...t,meta:{fetchMore:{direction:"forward"}}})}fetchPreviousPage(t){return this.fetch({...t,meta:{fetchMore:{direction:"backward"}}})}createResult(t,r){var i,g;const{state:a}=t,n=super.createResult(t,r),{isFetching:l,isRefetching:d,isError:x,isRefetchError:m}=n,o=(g=(i=a.fetchMeta)==null?void 0:i.fetchMore)==null?void 0:g.direction,u=x&&o==="forward",h=l&&o==="forward",p=x&&o==="backward",f=l&&o==="backward";return{...n,fetchNextPage:this.fetchNextPage,fetchPreviousPage:this.fetchPreviousPage,hasNextPage:V(r,a.data),hasPreviousPage:G(r,a.data),isFetchNextPageError:u,isFetchingNextPage:h,isFetchPreviousPageError:p,isFetchingPreviousPage:f,isRefetchError:m&&!u&&!p,isRefetching:d&&!h&&!f}}};function ge(t,r){return J(t,xe)}function pe({title:t,titleId:r,...a},n){return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":r},a),t?s.createElement("title",{id:r},t):null,s.createElement("path",{fillRule:"evenodd",d:"M11.78 5.22a.75.75 0 0 1 0 1.06L8.06 10l3.72 3.72a.75.75 0 1 1-1.06 1.06l-4.25-4.25a.75.75 0 0 1 0-1.06l4.25-4.25a.75.75 0 0 1 1.06 0Z",clipRule:"evenodd"}))}const fe=s.forwardRef(pe);function be({title:t,titleId:r,...a},n){return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":r},a),t?s.createElement("title",{id:r},t):null,s.createElement("path",{fillRule:"evenodd",d:"M13.887 3.182c.396.037.79.08 1.183.128C16.194 3.45 17 4.414 17 5.517V16.75A2.25 2.25 0 0 1 14.75 19h-9.5A2.25 2.25 0 0 1 3 16.75V5.517c0-1.103.806-2.068 1.93-2.207.393-.048.787-.09 1.183-.128A3.001 3.001 0 0 1 9 1h2c1.373 0 2.531.923 2.887 2.182ZM7.5 4A1.5 1.5 0 0 1 9 2.5h2A1.5 1.5 0 0 1 12.5 4v.5h-5V4Z",clipRule:"evenodd"}))}const we=s.forwardRef(be);function ke({title:t,titleId:r,...a},n){return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":r},a),t?s.createElement("title",{id:r},t):null,s.createElement("path",{fillRule:"evenodd",d:"M7.84 1.804A1 1 0 0 1 8.82 1h2.36a1 1 0 0 1 .98.804l.331 1.652a6.993 6.993 0 0 1 1.929 1.115l1.598-.54a1 1 0 0 1 1.186.447l1.18 2.044a1 1 0 0 1-.205 1.251l-1.267 1.113a7.047 7.047 0 0 1 0 2.228l1.267 1.113a1 1 0 0 1 .206 1.25l-1.18 2.045a1 1 0 0 1-1.187.447l-1.598-.54a6.993 6.993 0 0 1-1.929 1.115l-.33 1.652a1 1 0 0 1-.98.804H8.82a1 1 0 0 1-.98-.804l-.331-1.652a6.993 6.993 0 0 1-1.929-1.115l-1.598.54a1 1 0 0 1-1.186-.447l-1.18-2.044a1 1 0 0 1 .205-1.251l1.267-1.114a7.05 7.05 0 0 1 0-2.227L1.821 7.773a1 1 0 0 1-.206-1.25l1.18-2.045a1 1 0 0 1 1.187-.447l1.598.54A6.992 6.992 0 0 1 7.51 3.456l.33-1.652ZM10 13a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z",clipRule:"evenodd"}))}const ve=s.forwardRef(ke);function je({title:t,titleId:r,...a},n){return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":r},a),t?s.createElement("title",{id:r},t):null,s.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 1 0 0-16 8 8 0 0 0 0 16Zm3.536-4.464a.75.75 0 1 0-1.061-1.061 3.5 3.5 0 0 1-4.95 0 .75.75 0 0 0-1.06 1.06 5 5 0 0 0 7.07 0ZM9 8.5c0 .828-.448 1.5-1 1.5s-1-.672-1-1.5S7.448 7 8 7s1 .672 1 1.5Zm3 1.5c.552 0 1-.672 1-1.5S12.552 7 12 7s-1 .672-1 1.5.448 1.5 1 1.5Z",clipRule:"evenodd"}))}const ye=s.forwardRef(je);function Ce({title:t,titleId:r,...a},n){return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":r},a),t?s.createElement("title",{id:r},t):null,s.createElement("path",{d:"M3.105 2.288a.75.75 0 0 0-.826.95l1.414 4.926A1.5 1.5 0 0 0 5.135 9.25h6.115a.75.75 0 0 1 0 1.5H5.135a1.5 1.5 0 0 0-1.442 1.086l-1.414 4.926a.75.75 0 0 0 .826.95 28.897 28.897 0 0 0 15.293-7.155.75.75 0 0 0 0-1.114A28.897 28.897 0 0 0 3.105 2.288Z"}))}const Ne=s.forwardRef(Ce),Re=t=>{const r=s.useRef(new IntersectionObserver(l=>{l.forEach(d=>{d.isIntersecting&&t()})},{root:document.getElementById("chat-container"),threshold:.8})),a=s.useCallback(l=>{r.current.observe(l)},[]),n=s.useCallback(l=>{r.current.unobserve(l)},[]);return[a,n]};function Ee({isOpen:t,modalData:r,onClose:a,onConfirm:n}){const[l,d]=s.useState(""),x=s.useCallback(async o=>{o.preventDefault(),n({name:l})},[n,l]),m=s.useMemo(()=>!l||l.length<3||(r==null?void 0:r.name)!==l,[l,r==null?void 0:r.name]);return e.jsx(W,{isOpen:t,title:"채팅방 삭제하기",onClose:a,children:e.jsxs("form",{className:"space-y-4 sm:space-y-8",onSubmit:x,children:[e.jsxs("div",{children:[e.jsx("p",{className:"mb-1 text-12-SB-16 spring:text-pink-950 winter:text-white sm:text-16-SB-24 dark:spring:text-pink-50 dark:winter:text-blue-100",children:"삭제하려는 채팅방 제목을 입력하세요."}),e.jsx(Y,{maxLength:20,minLength:3,value:l,autoFocus:!0,onChange:d})]}),e.jsx(D,{disabled:m,size:"medium",text:"삭제하기",type:"submit",variant:"contained"})]})})}const Pe=async t=>I(`/v2/chats/${t}`).then(r=>r.data),Me=()=>{const{id:t}=R(),r=t||"";return U({queryFn:()=>Pe(r),queryKey:A.detail(r),select:n=>n})},Fe=async(t,r)=>I(`/v2/chats/${t}/messages`,{nextCursor:r||null}).then(a=>a.data),Se=t=>{const{onChatJoin:r}=B(),a=s.useRef(!1),{data:n,...l}=ge({getNextPageParam:()=>{},getPreviousPageParam:d=>Number(d.nextCursor)>0?d.nextCursor:void 0,initialPageParam:"",queryFn:({pageParam:d})=>Fe(t,d),queryKey:A.history(t),refetchOnMount:!0,refetchOnReconnect:!1,refetchOnWindowFocus:!1});return s.useEffect(()=>{!a.current&&t&&(a.current=!0,r([t]))},[t,r]),{data:n,...l}},Le=async({chatId:t})=>de("/v2/chats",{chatId:t}).then(r=>r.data),Oe=({onError:t,onSuccess:r})=>X({mutationFn:Le,onError:n=>{t&&t(n)},onSuccess:()=>{r&&r()}});function $e({children:t,...r}){return e.jsx("ul",{...r,className:"flex w-full flex-col-reverse gap-y-5 overflow-auto p-5 scrollbar-hide",children:t})}function $({createdAt:t,message:r,nickname:a,position:n}){return e.jsxs("li",{className:`${n==="right"?"ml-auto":"mr-auto"} w-max`,children:[e.jsxs("div",{className:`${n==="right"?"flex-row-reverse":"flex-row"} flex items-start gap-x-2.5`,children:[e.jsx("div",{className:"flex size-10 shrink-0 items-center justify-center rounded-lg spring:border spring:border-pink-900 spring:bg-pink-900 winter:border winter:border-blue-900 winter:bg-blue-900 sm:size-12 dark:spring:bg-pink-100 dark:winter:bg-blue-100",children:e.jsx(oe,{className:"size-5 spring:text-pink-50 winter:text-blue-100 sm:size-6 dark:spring:text-pink-950 dark:winter:text-blue-900"})}),e.jsx("p",{className:"text-12-B-16 spring:text-pink-950 winter:text-blue-100 winter:text-shadow sm:text-14-B-20 dark:spring:text-pink-50 dark:winter:text-blue-100",children:a})]}),e.jsxs("div",{className:`${n==="right"?"mr-2.5 flex-col items-start sm:flex-row-reverse":"ml-2.5 flex-col items-end sm:flex-row"} -mt-2.5 flex gap-2.5 sm:items-end`,children:[e.jsx("p",{className:`${n==="right"?"mr-10 !rounded-tr-none sm:mr-[50px]":"ml-10 !rounded-tl-none sm:ml-[50px]"} max-w-[calc(100vw-90px)] whitespace-pre-wrap break-all rounded-xl p-2.5 text-12-R-16 spring:border spring:border-pink-900 spring:bg-pink-50 spring:text-pink-950 winter:border winter:border-blue-900 winter:bg-blue-50 winter:text-blue-900 sm:w-max sm:max-w-sm sm:rounded-3xl sm:p-5 sm:text-14-R-20`,children:r}),e.jsx("time",{className:"text-10-L-12 spring:text-pink-950 winter:text-white winter:text-shadow sm:text-12-L-16 dark:spring:text-pink-50 dark:spring:text-shadow dark:winter:text-blue-100/50",children:ce(t)})]})]})}function Ae({text:t}){return e.jsx("li",{className:"mb-auto",children:e.jsx("p",{className:"w-full text-center text-12-B-16 spring:text-pink-950 winter:text-white sm:text-14-B-20 dark:spring:text-pink-50 dark:winter:text-blue-100",children:t})})}function Be(){return e.jsx("li",{className:"flex h-32 w-full items-center justify-center",children:e.jsx("div",{className:"h-10 w-10 animate-spin rounded-full border-4 !border-b-transparent spring:border-pink-900 winter:border-blue-600 dark:spring:border-pink-100 dark:winter:border-blue-100"})})}function ze(){return e.jsxs("div",{className:"flex w-full animate-pulse flex-col gap-y-5 overflow-auto p-5 scrollbar-hide",children:[e.jsx("div",{className:"mx-auto mb-auto h-4 w-40 rounded spring:bg-white/30 winter:bg-blue-50/10 sm:h-5 dark:spring:bg-pink-50/10 dark:winter:bg-blue-50/10"}),Array.from({length:5},(t,r)=>e.jsxs("div",{className:`${r%2!==0?"ml-auto":"mr-auto"} w-max sm:w-1/3`,children:[e.jsxs("div",{className:`${r%2!==0?"flex-row-reverse":"flex-row"} flex items-start gap-x-2.5`,children:[e.jsx("div",{className:"size-12 shrink-0 rounded-lg spring:bg-white/30 winter:bg-blue-50/10 dark:spring:bg-pink-50/10 dark:winter:bg-blue-50/10"}),e.jsx("div",{className:"h-4 w-12 rounded spring:bg-white/30 winter:bg-blue-50/10 sm:h-5 dark:spring:bg-pink-50/10 dark:winter:bg-blue-50/10"})]}),e.jsxs("div",{className:`${r%2!==0?"mr-2.5 flex-col items-start sm:flex-row-reverse":"ml-2.5 flex-col items-end sm:flex-row"} -mt-2.5 flex w-full gap-2.5 sm:items-end`,children:[e.jsx("div",{className:`${r%2!==0?"mr-[50px] !rounded-tr-none sm:mr-[60px]":"ml-10 !rounded-tl-none sm:ml-[50px]"} h-[38px] w-40 rounded-xl spring:bg-white/30 winter:bg-blue-50/10 sm:h-[62px] sm:w-full sm:min-w-40 sm:rounded-3xl dark:spring:bg-pink-50/10 dark:winter:bg-blue-50/10`}),e.jsx("div",{className:"h-3 w-12 shrink-0 rounded spring:bg-white/30 winter:bg-blue-50/10 sm:h-4 dark:spring:bg-pink-50/10 dark:winter:bg-blue-50/10"})]})]},r))]})}function Ie({onSubmit:t}){const{id:r}=R(),a=r||"",{onToast:n}=z(),l=s.useRef(null),[d,x]=s.useState(!1),m=s.useRef(null),[o,u]=s.useState(""),h=s.useCallback(()=>{if(a){if(navigator.clipboard)navigator.clipboard.writeText(a);else{const i=document.createElement("textarea");i.value=a,document.body.appendChild(i),i.select(),document.execCommand("copy"),document.body.removeChild(i)}n("초대 코드가 복사되었습니다.",{canDismiss:!0,delay:3e3})}else n("문제가 발생하였습니다. 잠시 후에 다시 시도해 주세요.",{canDismiss:!0,delay:5e3})},[a,n]),p=s.useCallback(()=>{t(o.trim()),u("")},[t,o]),f=s.useCallback(i=>{i.shiftKey&&i.key==="Enter"?u(g=>`${g}
`.trim()):!i.isComposing&&i.key==="Enter"&&(i.preventDefault(),o.trim().length>0?p():n("메시지를 입력해 주세요!",{canDismiss:!0,delay:5e3}))},[o,p,n]),b=s.useCallback(i=>{x(!1),u(g=>g+i.emoji)},[]);return s.useEffect(()=>{m.current&&(m.current.style.height="auto",m.current.style.height=`${m.current.scrollHeight}px`)},[o]),s.useEffect(()=>{function i(g){var v;d&&!((v=l.current)!=null&&v.contains(g.target))&&x(!1)}return document.addEventListener("mousedown",i),()=>{document.removeEventListener("mousedown",i)}},[d]),e.jsxs("div",{ref:l,className:"fixed inset-x-0 bottom-0 w-full divide-y border-t spring:divide-pink-900 spring:border-t-pink-900 spring:bg-white winter:divide-blue-900 winter:border-t-blue-900 winter:bg-white dark:spring:divide-pink-100 dark:spring:border-t-pink-100 dark:spring:bg-transparent dark:winter:divide-blue-100 dark:winter:border-t-blue-100 dark:winter:bg-black",children:[e.jsxs("div",{className:"flex w-full items-center gap-5 py-2.5 pl-2.5 pr-5",children:[e.jsx("textarea",{ref:m,className:"h-6 flex-1 resize-none bg-transparent text-18-R-28 backdrop-filter transition-all scrollbar-hide spring:text-pink-950 spring:placeholder:text-pink-950/50 winter:text-blue-900 winter:placeholder:text-blue-900/50 dark:spring:text-pink-950 dark:spring:placeholder:text-pink-50/80 dark:winter:text-blue-100 dark:winter:placeholder:text-blue-100/30",maxLength:140,value:o,onChange:i=>u(i.currentTarget.value),onKeyDown:i=>f(i.nativeEvent)}),e.jsxs("div",{className:"flex shrink-0 items-center gap-x-5 spring:[&_svg]:text-pink-950 winter:[&_svg]:text-blue-900 dark:spring:[&_svg]:text-pink-950 dark:winter:[&_svg]:text-blue-100",children:[e.jsx(k,{"aria-label":"open emoji picker",size:"medium",title:"이모티콘 보기",variant:"text",icon:e.jsx(ye,{}),onClick:()=>x(i=>!i)}),o?e.jsx(k,{"aria-label":"send message",disabled:!o||o.trim().length===0,size:"medium",title:"메시지 보내기",variant:"text",icon:e.jsx(Ne,{}),onClick:p}):e.jsx(k,{"aria-label":"copy chat id",size:"medium",title:"초대 코드 공유하기",variant:"text",icon:e.jsx(we,{}),onClick:h})]})]}),e.jsx(he,{searchDisabled:!0,height:300,style:{borderRadius:0,border:"none"},theme:ue(me.MODE),width:"100%",lazyLoadEmojis:!0,onEmojiClick:b,open:d})]})}function He(){const t=ee(),{id:r}=R(),a=r||"",{accountId:n,nickname:l}=te(),{mode:d,onModeChange:x,onThemeChange:m}=re(),{onToast:o}=z(),{data:u}=Me(),{data:h,fetchPreviousPage:p,hasPreviousPage:f,isFetchingPreviousPage:b,isLoading:i}=Se(a),{isPending:g,mutate:v}=Oe({onError(c){o(c.message,{delay:5e3})},onSuccess(){N(a),t("/",{replace:!0})}}),T=s.useMemo(()=>{var c;return((c=h==null?void 0:h.pages)==null?void 0:c.flatMap(w=>w.data).reverse())||[]},[h==null?void 0:h.pages]),{message:C,onCurrentChatLeave:N,onMessageSend:E}=B(),j=s.useRef(null),[y,P]=s.useState(!1),[M,F]=Re(()=>{setTimeout(()=>{P(!1),p()},1e3)}),S=se({onConfirm(){v({chatId:a})}}),{onOpen:L}=S,Z=s.useCallback(()=>N(a),[N,a]),Q=s.useCallback(()=>{u!=null&&u.chatName&&L({name:u.chatName})},[u==null?void 0:u.chatName,L]),_=s.useCallback(c=>{n&&l?E({messageBody:{chatId:a,message:c,nickname:l,userId:n}}):o(`문제가 발생하였습니다.
잠시 후에 다시 시도해주세요.`,{delay:5e3})},[n,a,l,E,o]);s.useEffect(()=>{j.current&&(!y&&!b&&f&&(P(!0),M(j.current)),f||F(j.current))},[y,b,f,M,F]);const K=s.useMemo(()=>y||b,[y,b]);return e.jsxs(e.Fragment,{children:[e.jsx("header",{className:"fixed inset-x-0 top-0 z-10 shadow-sm spring:shadow-pink-50 winter:shadow-blue-50 dark:spring:shadow-pink-100 dark:winter:shadow-blue-100",children:e.jsxs("div",{className:"flex h-14 w-full items-center justify-between pl-2.5 pr-2.5 sm:pr-5",children:[e.jsxs(ne,{className:"flex items-center gap-1",onClick:Z,to:"/",children:[e.jsx(fe,{className:"size-6 spring:text-pink-950 winter:text-white sm:size-8 dark:spring:text-pink-50 dark:winter:text-blue-100"}),e.jsx("h1",{className:"line-clamp-1 text-center font-jua text-18-R-28 spring:text-pink-950 winter:text-white sm:text-24-R-32 dark:spring:text-pink-50 dark:winter:text-blue-100",children:(u==null?void 0:u.chatName)||""})]}),e.jsxs("div",{className:"flex flex-1 items-center justify-end gap-x-2.5 sm:gap-5",children:[e.jsx(k,{"aria-label":`change to ${d==="light"?"dark":"light"} mode`,size:"small",title:`${d==="light"?"다크":"라이트"} 모드로 변경하기`,variant:"text",icon:d==="light"?e.jsx(ae,{}):e.jsx(ie,{}),onClick:x}),e.jsx(k,{"aria-label":"change theme",size:"small",title:"테마 변경하기",variant:"text",icon:e.jsx(le,{className:"spring:text-blue-900 winter:text-pink-950 dark:spring:text-blue-100 dark:winter:text-pink-50"}),onClick:m}),e.jsx(k,{"aria-label":"leave chat",size:"small",title:"채팅방 나가기",variant:"text",icon:e.jsx(ve,{}),onClick:Q})]})]})}),e.jsxs("main",{className:"flex size-full flex-col justify-between pt-14",children:[e.jsx(Ee,{...S}),i||g?e.jsx(ze,{}):e.jsxs(e.Fragment,{children:[e.jsxs($e,{id:"chat-container",style:{height:window.innerHeight-56-77,overflowAnchor:"none"},children:[C==null?void 0:C.map((c,w)=>e.jsx($,{createdAt:c.createdAt,message:c.message,nickname:c.nickname,position:c.userId===n?"right":"left"},w)),T.map((c,w)=>{const H=c.sender===null?!1:c.sender.userId===n;return c.sender===null?e.jsx(Ae,{text:c.message},w):e.jsx($,{createdAt:c.createdAt,message:c.message,nickname:c.sender.nickname,position:H?"right":"left"},w)}),e.jsx("li",{ref:j,className:"h-px w-full"}),K&&e.jsx(Be,{})]}),e.jsx(Ie,{onSubmit:_})]})]})]})}export{He as default};
