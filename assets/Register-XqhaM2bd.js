import{r as o,j as e}from"./@react-vendor-BjtCfNPP.js";import{d as R,e as L,u as I,a as P,b as _,c as A,T as u,B as p}from"./index-BjXlQM_C.js";import{S as U}from"./SubmitLoader-ClEIUoU0.js";import{b as z,p as D,e as $}from"./@network-vendor-CcVnuzvd.js";const g=/^[ㄱ-ㅎ가-힣a-zA-Z0-9]+$/,m=/^(?=.*[a-zA-Z])(?=.*[0-9]).{6,20}$/,f=/^(?=.*[a-zA-Z])(?=.*[0-9])(?=.*[!@#$%^&*?_]).{8,16}$/,F=async({accountId:t})=>z(`/v2/users/${t}/exists`).then(a=>a.data).then(a=>({data:{isUsed:a.isUsed},message:a.isUsed?"사용 중인 아이디입니다.":"사용 가능한 아이디입니다.",status:200})),G=t=>R({enabled:m.test(t),queryFn:({queryKey:l})=>F({accountId:l[1]}),queryKey:L.existingId(t),select:l=>l.data.isUsed}),K=async t=>D("/v2/users",t).then(a=>a.data),X=({onError:t,onSuccess:a})=>I({mutationFn:K,onError:s=>{t&&t(s)},onSuccess:s=>{a&&a(s)}});function Q(){const t=P(),{onSocketConnect:a}=_(),{onToast:l}=A(),[s,k]=o.useState(""),[i,b]=o.useState(""),[r,j]=o.useState(""),[c,w]=o.useState(""),[E,x]=o.useState(!1),{data:d}=G(s),{mutate:h}=X({onError(n){x(!1),l(n.message,{delay:5e3})},onSuccess({tokens:n}){$(n),a(),x(!1),t("/",{replace:!0})}}),C=o.useCallback(n=>{n.preventDefault(),x(!0),h({id:s,nickname:i,password:r})},[h,s,i,r]),S=o.useCallback(()=>{t("/login")},[t]),y=o.useMemo(()=>{let n=!0;return g.test(i)||(n=!1),(!m.test(s)||d)&&(n=!1),f.test(r)||(n=!1),r!==c&&(n=!1),n},[s,r,c,i,d]),{idErrorMessage:v,nicknameErrorMessage:M,passwordCheckErrorMessage:T,passwordErrorMessage:N}=o.useMemo(()=>({nicknameErrorMessage:i.length<3?"최소 3자, 최대 20자까지 입력할 수 있습니다.":g.test(i)?"":"영문과 숫자 조합으로 입력하세요.",idErrorMessage:d?"중복된 아이디입니다. 다른 아이디를 입력하세요.":s.length<6?"최소 6자, 최대 20자까지 입력할 수 있습니다.":m.test(s)?"":"영문과 숫자 조합으로 입력하세요.",passwordErrorMessage:r.length<8?"최소 8자, 최대 16자까지 입력할 수 있습니다.":f.test(r)?"":"영문, 숫자, 특수문자 조합으로 입력하세요.",passwordCheckErrorMessage:c?r!==c?"비밀번호와 일치하지 않습니다.":"":"비밀번호 확인을 입력하세요."}),[i,d,s,r,c]);return e.jsxs("div",{className:"mt-5 flex h-full w-full items-start justify-center md:mt-0",children:[E&&e.jsx(U,{}),e.jsxs("form",{className:"flex w-full max-w-screen-md flex-col gap-5 px-5",onSubmit:C,children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-center font-jua text-28-R-36 spring:text-pink-950 winter:text-white md:text-36-R-40 dark:spring:text-pink-50 dark:winter:text-blue-100",children:["작은 대화",e.jsx("br",{})]}),e.jsx("h2",{className:"mb-5 text-center font-jua text-24-R-32 spring:text-pink-950 winter:text-white md:mb-10 md:text-28-R-36 dark:spring:text-pink-50 dark:winter:text-blue-100",children:"회원가입"})]}),e.jsx(u,{helperText:M,labelText:"Nickname",maxLength:20,minLength:3,type:"text",value:i,onChange:b,placeholder:"닉네임을 입력하세요."}),e.jsx(u,{helperText:v,labelText:"Id",maxLength:20,minLength:6,type:"text",value:s,onChange:k,placeholder:"아이디를 입력하세요."}),e.jsx(u,{helperText:N,labelText:"Password",maxLength:16,minLength:8,type:"password",value:r,onChange:j,placeholder:"비밀번호를 입력하세요."}),e.jsx(u,{helperText:T,labelText:"Password Check",maxLength:16,minLength:8,type:"password",value:c,onChange:w,placeholder:"비밀번호 확인을 입력하세요."}),e.jsxs("div",{className:"mt-4 flex flex-col gap-2",children:[e.jsx(p,{disabled:!y,size:"large",text:"회원가입",type:"submit",variant:"contained"}),e.jsx(p,{size:"large",text:"로그인",type:"button",variant:"outlined",onClick:S})]})]})]})}export{Q as default};
