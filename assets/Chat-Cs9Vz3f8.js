import{r as s,j as e}from"./@react-vendor-BjtCfNPP.js";import{Q as H,i as $,h as G,g as V,j as Y,M as J,T as W,B as D,k as E,d as U,f as R,l as X,b as B,u as ee,c as z,I as k,a as te,m as re,n as se,o as ne,L as ae,F as ie,p as le,q as oe}from"./index-Dfbd6Umo.js";import{F as ce,g as de}from"./date-DmubfGXO.js";import{b as I,f as ue,g as me,S as he}from"./@network-vendor-CcVnuzvd.js";import{E as xe}from"./@emoji-vendor-Df1QA2W1.js";var ge=class extends H{constructor(t,r){super(t,r)}bindMethods(){super.bindMethods(),this.fetchNextPage=this.fetchNextPage.bind(this),this.fetchPreviousPage=this.fetchPreviousPage.bind(this)}setOptions(t,r){super.setOptions({...t,behavior:$()},r)}getOptimisticResult(t){return t.behavior=$(),super.getOptimisticResult(t)}fetchNextPage(t){return this.fetch({...t,meta:{fetchMore:{direction:"forward"}}})}fetchPreviousPage(t){return this.fetch({...t,meta:{fetchMore:{direction:"backward"}}})}createResult(t,r){var i,g;const{state:a}=t,n=super.createResult(t,r),{isFetching:l,isRefetching:u,isError:m,isRefetchError:h}=n,o=(g=(i=a.fetchMeta)==null?void 0:i.fetchMore)==null?void 0:g.direction,c=m&&o==="forward",x=l&&o==="forward",p=m&&o==="backward",f=l&&o==="backward";return{...n,fetchNextPage:this.fetchNextPage,fetchPreviousPage:this.fetchPreviousPage,hasNextPage:V(r,a.data),hasPreviousPage:G(r,a.data),isFetchNextPageError:c,isFetchingNextPage:x,isFetchPreviousPageError:p,isFetchingPreviousPage:f,isRefetchError:h&&!c&&!p,isRefetching:u&&!x&&!f}}};function pe(t,r){return Y(t,ge)}function fe({title:t,titleId:r,...a},n){return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":r},a),t?s.createElement("title",{id:r},t):null,s.createElement("path",{fillRule:"evenodd",d:"M11.78 5.22a.75.75 0 0 1 0 1.06L8.06 10l3.72 3.72a.75.75 0 1 1-1.06 1.06l-4.25-4.25a.75.75 0 0 1 0-1.06l4.25-4.25a.75.75 0 0 1 1.06 0Z",clipRule:"evenodd"}))}const be=s.forwardRef(fe);function we({title:t,titleId:r,...a},n){return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":r},a),t?s.createElement("title",{id:r},t):null,s.createElement("path",{fillRule:"evenodd",d:"M13.887 3.182c.396.037.79.08 1.183.128C16.194 3.45 17 4.414 17 5.517V16.75A2.25 2.25 0 0 1 14.75 19h-9.5A2.25 2.25 0 0 1 3 16.75V5.517c0-1.103.806-2.068 1.93-2.207.393-.048.787-.09 1.183-.128A3.001 3.001 0 0 1 9 1h2c1.373 0 2.531.923 2.887 2.182ZM7.5 4A1.5 1.5 0 0 1 9 2.5h2A1.5 1.5 0 0 1 12.5 4v.5h-5V4Z",clipRule:"evenodd"}))}const ke=s.forwardRef(we);function ve({title:t,titleId:r,...a},n){return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":r},a),t?s.createElement("title",{id:r},t):null,s.createElement("path",{fillRule:"evenodd",d:"M7.84 1.804A1 1 0 0 1 8.82 1h2.36a1 1 0 0 1 .98.804l.331 1.652a6.993 6.993 0 0 1 1.929 1.115l1.598-.54a1 1 0 0 1 1.186.447l1.18 2.044a1 1 0 0 1-.205 1.251l-1.267 1.113a7.047 7.047 0 0 1 0 2.228l1.267 1.113a1 1 0 0 1 .206 1.25l-1.18 2.045a1 1 0 0 1-1.187.447l-1.598-.54a6.993 6.993 0 0 1-1.929 1.115l-.33 1.652a1 1 0 0 1-.98.804H8.82a1 1 0 0 1-.98-.804l-.331-1.652a6.993 6.993 0 0 1-1.929-1.115l-1.598.54a1 1 0 0 1-1.186-.447l-1.18-2.044a1 1 0 0 1 .205-1.251l1.267-1.114a7.05 7.05 0 0 1 0-2.227L1.821 7.773a1 1 0 0 1-.206-1.25l1.18-2.045a1 1 0 0 1 1.187-.447l1.598.54A6.992 6.992 0 0 1 7.51 3.456l.33-1.652ZM10 13a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z",clipRule:"evenodd"}))}const je=s.forwardRef(ve);function ye({title:t,titleId:r,...a},n){return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":r},a),t?s.createElement("title",{id:r},t):null,s.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 1 0 0-16 8 8 0 0 0 0 16Zm3.536-4.464a.75.75 0 1 0-1.061-1.061 3.5 3.5 0 0 1-4.95 0 .75.75 0 0 0-1.06 1.06 5 5 0 0 0 7.07 0ZM9 8.5c0 .828-.448 1.5-1 1.5s-1-.672-1-1.5S7.448 7 8 7s1 .672 1 1.5Zm3 1.5c.552 0 1-.672 1-1.5S12.552 7 12 7s-1 .672-1 1.5.448 1.5 1 1.5Z",clipRule:"evenodd"}))}const Ce=s.forwardRef(ye);function Ne({title:t,titleId:r,...a},n){return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":r},a),t?s.createElement("title",{id:r},t):null,s.createElement("path",{d:"M3.105 2.288a.75.75 0 0 0-.826.95l1.414 4.926A1.5 1.5 0 0 0 5.135 9.25h6.115a.75.75 0 0 1 0 1.5H5.135a1.5 1.5 0 0 0-1.442 1.086l-1.414 4.926a.75.75 0 0 0 .826.95 28.897 28.897 0 0 0 15.293-7.155.75.75 0 0 0 0-1.114A28.897 28.897 0 0 0 3.105 2.288Z"}))}const Re=s.forwardRef(Ne),Ee=t=>{const r=s.useRef(new IntersectionObserver(l=>{l.forEach(u=>{u.isIntersecting&&t()})},{root:document.getElementById("chat-container"),threshold:.8})),a=s.useCallback(l=>{r.current.observe(l)},[]),n=s.useCallback(l=>{r.current.unobserve(l)},[]);return[a,n]};function Pe({isOpen:t,modalData:r,onClose:a,onConfirm:n}){const[l,u]=s.useState(""),m=s.useCallback(async o=>{o.preventDefault(),n({name:l})},[n,l]),h=s.useMemo(()=>!l||l.length<3||(r==null?void 0:r.name)!==l,[l,r==null?void 0:r.name]);return e.jsx(J,{isOpen:t,title:"채팅방 삭제하기",onClose:a,children:e.jsxs("form",{className:"space-y-4 sm:space-y-8",onSubmit:m,children:[e.jsxs("div",{children:[e.jsx("p",{className:"mb-1 text-12-SB-16 spring:text-pink-950 winter:text-white sm:text-16-SB-24 dark:spring:text-pink-50 dark:winter:text-blue-100",children:"삭제하려는 채팅방 제목을 입력하세요."}),e.jsx(W,{maxLength:20,minLength:3,value:l,autoFocus:!0,onChange:u})]}),e.jsx(D,{disabled:h,size:"medium",text:"삭제하기",type:"submit",variant:"contained"})]})})}const Me=async t=>I(`/v2/chats/${t}`).then(r=>r.data),Se=()=>{const{id:t}=E(),r=t||"";return U({queryFn:()=>Me(r),queryKey:R.detail(r),select:n=>n})},Fe=async(t,r)=>I(`/v2/chats/${t}/messages`,{nextCursor:r||null}).then(a=>a.data),Le=t=>{const r=X(),{onChatJoin:a}=B(),n=s.useRef(!1);s.useEffect(()=>{r.removeQueries({queryKey:R.history(t)})},[t,r]);const{data:l,...u}=pe({getNextPageParam:()=>{},getPreviousPageParam:m=>Number(m.nextCursor)>0?m.nextCursor:void 0,initialPageParam:"",queryFn:({pageParam:m})=>Fe(t,m),queryKey:R.history(t),refetchOnMount:!0,refetchOnReconnect:!1,refetchOnWindowFocus:!1});return s.useEffect(()=>{!n.current&&t&&(n.current=!0,a([t]))},[t,a]),{data:l,...u}},Oe=async({chatId:t})=>ue("/v2/chats",{chatId:t}).then(r=>r.data),$e=({onError:t,onSuccess:r})=>ee({mutationFn:Oe,onError:n=>{t&&t(n)},onSuccess:()=>{r&&r()}});function Ae({children:t,...r}){return e.jsx("ul",{...r,className:"flex w-full flex-col-reverse gap-y-5 overflow-auto p-5 scrollbar-hide",children:t})}function A({createdAt:t,message:r,nickname:a,position:n}){return e.jsxs("li",{className:`${n==="right"?"ml-auto":"mr-auto"} w-max`,children:[e.jsxs("div",{className:`${n==="right"?"flex-row-reverse":"flex-row"} flex items-start gap-x-2.5`,children:[e.jsx("div",{className:"flex size-10 shrink-0 items-center justify-center rounded-lg spring:border spring:border-pink-900 spring:bg-pink-900 winter:border winter:border-blue-900 winter:bg-blue-900 sm:size-12 dark:spring:bg-pink-100 dark:winter:bg-blue-100",children:e.jsx(ce,{className:"size-5 spring:text-pink-50 winter:text-blue-100 sm:size-6 dark:spring:text-pink-950 dark:winter:text-blue-900"})}),e.jsx("p",{className:"text-12-B-16 spring:text-pink-950 winter:text-blue-100 winter:text-shadow sm:text-14-B-20 dark:spring:text-pink-50 dark:winter:text-blue-100",children:a})]}),e.jsxs("div",{className:`${n==="right"?"mr-2.5 flex-col items-start sm:flex-row-reverse":"ml-2.5 flex-col items-end sm:flex-row"} -mt-2.5 flex gap-2.5 sm:items-end`,children:[e.jsx("p",{className:`${n==="right"?"mr-10 !rounded-tr-none sm:mr-[50px]":"ml-10 !rounded-tl-none sm:ml-[50px]"} max-w-[calc(100vw-90px)] whitespace-pre-wrap break-all rounded-xl p-2.5 text-12-R-16 spring:border spring:border-pink-900 spring:bg-pink-50 spring:text-pink-950 winter:border winter:border-blue-900 winter:bg-blue-50 winter:text-blue-900 sm:w-max sm:max-w-sm sm:rounded-3xl sm:p-5 sm:text-14-R-20`,children:r}),e.jsx("time",{className:"text-10-L-12 spring:text-pink-950 winter:text-white winter:text-shadow sm:text-12-L-16 dark:spring:text-pink-50 dark:spring:text-shadow dark:winter:text-blue-100/50",children:de(t)})]})]})}function Be({text:t}){return e.jsx("li",{className:"mb-auto",children:e.jsx("p",{className:"w-full text-center text-12-B-16 spring:text-pink-950 winter:text-white sm:text-14-B-20 dark:spring:text-pink-50 dark:winter:text-blue-100",children:t})})}function ze(){return e.jsx("li",{className:"flex h-32 w-full items-center justify-center",children:e.jsx("div",{className:"h-10 w-10 animate-spin rounded-full border-4 !border-b-transparent spring:border-pink-900 winter:border-blue-600 dark:spring:border-pink-100 dark:winter:border-blue-100"})})}function Ie(){return e.jsxs("div",{className:"flex w-full animate-pulse flex-col gap-y-5 overflow-auto p-5 scrollbar-hide",children:[e.jsx("div",{className:"mx-auto mb-auto h-4 w-40 rounded spring:bg-white/30 winter:bg-blue-50/10 sm:h-5 dark:spring:bg-pink-50/10 dark:winter:bg-blue-50/10"}),Array.from({length:5},(t,r)=>e.jsxs("div",{className:`${r%2!==0?"ml-auto":"mr-auto"} w-max sm:w-1/3`,children:[e.jsxs("div",{className:`${r%2!==0?"flex-row-reverse":"flex-row"} flex items-start gap-x-2.5`,children:[e.jsx("div",{className:"size-12 shrink-0 rounded-lg spring:bg-white/30 winter:bg-blue-50/10 dark:spring:bg-pink-50/10 dark:winter:bg-blue-50/10"}),e.jsx("div",{className:"h-4 w-12 rounded spring:bg-white/30 winter:bg-blue-50/10 sm:h-5 dark:spring:bg-pink-50/10 dark:winter:bg-blue-50/10"})]}),e.jsxs("div",{className:`${r%2!==0?"mr-2.5 flex-col items-start sm:flex-row-reverse":"ml-2.5 flex-col items-end sm:flex-row"} -mt-2.5 flex w-full gap-2.5 sm:items-end`,children:[e.jsx("div",{className:`${r%2!==0?"mr-[50px] !rounded-tr-none sm:mr-[60px]":"ml-10 !rounded-tl-none sm:ml-[50px]"} h-[38px] w-40 rounded-xl spring:bg-white/30 winter:bg-blue-50/10 sm:h-[62px] sm:w-full sm:min-w-40 sm:rounded-3xl dark:spring:bg-pink-50/10 dark:winter:bg-blue-50/10`}),e.jsx("div",{className:"h-3 w-12 shrink-0 rounded spring:bg-white/30 winter:bg-blue-50/10 sm:h-4 dark:spring:bg-pink-50/10 dark:winter:bg-blue-50/10"})]})]},r))]})}function Te({onSubmit:t}){const{id:r}=E(),a=r||"",{onToast:n}=z(),l=s.useRef(null),[u,m]=s.useState(!1),h=s.useRef(null),[o,c]=s.useState(""),x=s.useCallback(()=>{if(a){if(navigator.clipboard)navigator.clipboard.writeText(a);else{const i=document.createElement("textarea");i.value=a,document.body.appendChild(i),i.select(),document.execCommand("copy"),document.body.removeChild(i)}n("초대 코드가 복사되었습니다.",{canDismiss:!0,delay:3e3})}else n("문제가 발생하였습니다. 잠시 후에 다시 시도해 주세요.",{canDismiss:!0,delay:5e3})},[a,n]),p=s.useCallback(()=>{t(o.trim()),c("")},[t,o]),f=s.useCallback(i=>{i.shiftKey&&i.key==="Enter"?c(g=>`${g}
`.trim()):!i.isComposing&&i.key==="Enter"&&(i.preventDefault(),o.trim().length>0?p():n("메시지를 입력해 주세요!",{canDismiss:!0,delay:5e3}))},[o,p,n]),b=s.useCallback(i=>{m(!1),c(g=>g+i.emoji)},[]);return s.useEffect(()=>{h.current&&(h.current.style.height="auto",h.current.style.height=`${h.current.scrollHeight}px`)},[o]),s.useEffect(()=>{function i(g){var v;u&&!((v=l.current)!=null&&v.contains(g.target))&&m(!1)}return document.addEventListener("mousedown",i),()=>{document.removeEventListener("mousedown",i)}},[u]),e.jsxs("div",{ref:l,className:"fixed inset-x-0 bottom-0 w-full divide-y border-t spring:divide-pink-900 spring:border-t-pink-900 spring:bg-white winter:divide-blue-900 winter:border-t-blue-900 winter:bg-white dark:spring:divide-pink-100 dark:spring:border-t-pink-100 dark:spring:bg-transparent dark:winter:divide-blue-100 dark:winter:border-t-blue-100 dark:winter:bg-black",children:[e.jsxs("div",{className:"flex w-full items-center gap-5 py-2.5 pl-2.5 pr-5",children:[e.jsx("textarea",{ref:h,className:"h-6 flex-1 resize-none bg-transparent text-18-R-28 backdrop-filter transition-all scrollbar-hide spring:text-pink-950 spring:placeholder:text-pink-950/50 winter:text-blue-900 winter:placeholder:text-blue-900/50 dark:spring:text-pink-950 dark:spring:placeholder:text-pink-50/80 dark:winter:text-blue-100 dark:winter:placeholder:text-blue-100/30",maxLength:140,value:o,onChange:i=>c(i.currentTarget.value),onKeyDown:i=>f(i.nativeEvent)}),e.jsxs("div",{className:"flex shrink-0 items-center gap-x-5 spring:[&_svg]:text-pink-950 winter:[&_svg]:text-blue-900 dark:spring:[&_svg]:text-pink-950 dark:winter:[&_svg]:text-blue-100",children:[e.jsx(k,{"aria-label":"open emoji picker",size:"medium",title:"이모티콘 보기",variant:"text",icon:e.jsx(Ce,{}),onClick:()=>m(i=>!i)}),o?e.jsx(k,{"aria-label":"send message",disabled:!o||o.trim().length===0,size:"medium",title:"메시지 보내기",variant:"text",icon:e.jsx(Re,{}),onClick:p}):e.jsx(k,{"aria-label":"copy chat id",size:"medium",title:"초대 코드 공유하기",variant:"text",icon:e.jsx(ke,{}),onClick:x})]})]}),e.jsx(xe,{searchDisabled:!0,height:300,style:{borderRadius:0,border:"none"},theme:me(he.MODE),width:"100%",lazyLoadEmojis:!0,onEmojiClick:b,open:u})]})}function He(){const t=te(),{id:r}=E(),a=r||"",{accountId:n,nickname:l}=re(),{mode:u,onModeChange:m,onThemeChange:h}=se(),{onToast:o}=z(),{data:c}=Se(),{data:x,fetchPreviousPage:p,hasPreviousPage:f,isFetchingPreviousPage:b,isLoading:i}=Le(a),{isPending:g,mutate:v}=$e({onError(d){o(d.message,{delay:5e3})},onSuccess(){N(a),t("/",{replace:!0})}}),T=s.useMemo(()=>{var d;return((d=x==null?void 0:x.pages)==null?void 0:d.flatMap(w=>w.data).reverse())||[]},[x==null?void 0:x.pages]),{message:C,onCurrentChatLeave:N,onMessageSend:P}=B(),j=s.useRef(null),[y,M]=s.useState(!1),[S,F]=Ee(()=>{setTimeout(()=>{M(!1),p()},1e3)}),L=ne({onConfirm(){v({chatId:a})}}),{onOpen:O}=L,Z=s.useCallback(()=>N(a),[N,a]),Q=s.useCallback(()=>{c!=null&&c.chatName&&O({name:c.chatName})},[c==null?void 0:c.chatName,O]),q=s.useCallback(d=>{n&&l?P({messageBody:{chatId:a,message:d,nickname:l,userId:n}}):o(`문제가 발생하였습니다.
잠시 후에 다시 시도해주세요.`,{delay:5e3})},[n,a,l,P,o]);s.useEffect(()=>{j.current&&(!y&&!b&&f&&(M(!0),S(j.current)),f||F(j.current))},[y,b,f,S,F]);const K=s.useMemo(()=>y||b,[y,b]);return e.jsxs(e.Fragment,{children:[e.jsx("header",{className:"fixed inset-x-0 top-0 z-10 shadow-sm spring:shadow-pink-50 winter:shadow-blue-50 dark:spring:shadow-pink-100 dark:winter:shadow-blue-100",children:e.jsxs("div",{className:"flex h-14 w-full items-center justify-between pl-2.5 pr-2.5 sm:pr-5",children:[e.jsxs(ae,{className:"flex items-center gap-1",onClick:Z,to:"/",children:[e.jsx(be,{className:"size-6 spring:text-pink-950 winter:text-white sm:size-8 dark:spring:text-pink-50 dark:winter:text-blue-100"}),e.jsx("h1",{className:"line-clamp-1 text-center font-jua text-18-R-28 spring:text-pink-950 winter:text-white sm:text-24-R-32 dark:spring:text-pink-50 dark:winter:text-blue-100",children:(c==null?void 0:c.chatName)||""})]}),e.jsxs("div",{className:"flex flex-1 items-center justify-end gap-x-2.5 sm:gap-5",children:[e.jsx(k,{"aria-label":`change to ${u==="light"?"dark":"light"} mode`,size:"small",title:`${u==="light"?"다크":"라이트"} 모드로 변경하기`,variant:"text",icon:u==="light"?e.jsx(ie,{}):e.jsx(le,{}),onClick:m}),e.jsx(k,{"aria-label":"change theme",size:"small",title:"테마 변경하기",variant:"text",icon:e.jsx(oe,{className:"spring:text-blue-900 winter:text-pink-950 dark:spring:text-blue-100 dark:winter:text-pink-50"}),onClick:h}),e.jsx(k,{"aria-label":"leave chat",size:"small",title:"채팅방 나가기",variant:"text",icon:e.jsx(je,{}),onClick:Q})]})]})}),e.jsxs("main",{className:"flex size-full flex-col justify-between pt-14",children:[e.jsx(Pe,{...L}),i||g?e.jsx(Ie,{}):e.jsxs(e.Fragment,{children:[e.jsxs(Ae,{id:"chat-container",style:{height:window.innerHeight-56-77,overflowAnchor:"none"},children:[C==null?void 0:C.map((d,w)=>e.jsx(A,{createdAt:d.createdAt,message:d.message,nickname:d.nickname,position:d.userId===n?"right":"left"},w)),T.map((d,w)=>{const _=d.userId===n;return d.type==="SYSTEM"?e.jsx(Be,{text:d.message},w):e.jsx(A,{createdAt:d.createdAt,message:d.message,nickname:d.nickname,position:_?"right":"left"},w)}),e.jsx("li",{ref:j,className:"h-px w-full"}),K&&e.jsx(ze,{})]}),e.jsx(Te,{onSubmit:q})]})]})]})}export{He as default};
